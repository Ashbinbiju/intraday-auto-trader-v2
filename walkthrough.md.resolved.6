# IntradayScreener Bot + Web UI

A complete automated trading system with a Python/FastAPI backend and a Next.js 14 frontend.

## Features implemented

## 1. Safety First ðŸ›¡ï¸
- **Trading Guard**: Enforces `9:30 AM` start time to avoid initial volatility.
- **Rate Limit Protection**: Throttles requests (5/sec) and implements smart retry logic for `AB2001` errors.
- **Error Handling**: Converts cryptic codes (e.g., `AG8001`) into human-readable logs ("Invalid Token").

## 2. Real-Time Core âš¡
- **WebSocket Orders**: Instant fill notifications via [smart_websocket.py](file:///C:/Users/Ashbin/.gemini/antigravity/brain/2df2ed12-f98d-4c89-bf98-dea5fc2acbc3/smart_websocket.py).
- **Postback**: Backup HTTPS webhook at `/webhook/angel-one`.

## 3. Full API Suite ðŸ’¼
The bot now exposes a complete REST API for programmatic control.

### Orders
- `POST /order/place`
- `POST /order/modify`
- `POST /order/cancel`
- `GET /order/book`
- `GET /order/trades`
- `POST /order/ltp`

### Portfolio
- `GET /portfolio/holdings`
- `GET /portfolio/positions`
- `POST /portfolio/convert`

### Tools
- `POST /tool/margin` (Margin Calculator)
- `POST /tool/brokerage` (Brokerage Calculator)

---
- **Backend (Python)**:
    -   Scrapes `intradayscreener.com` for Top Positive Sectors.
    -   Analyzes stocks in those sectors using SmartAPI (Angel One).
    -   Strategy: Buy if `Price > VWAP` and `Price > EMA 20` (15-min candles).
    -   Exposes live status and signals via REST API.
- **Frontend (Next.js)**:
    -   Futuristic Dark Mode Dashboard.
    -   Real-time "Top Sectors" visualization.
    -   Live "Signal Feed" for buy opportunities.

## Project Structure
- `.`: Backend (Python)
    -   [api.py](file:///C:/Users/Ashbin/.gemini/antigravity/brain/2df2ed12-f98d-4c89-bf98-dea5fc2acbc3/api.py): FastAPI server (Entry point).
    -   [main.py](file:///C:/Users/Ashbin/.gemini/antigravity/brain/2df2ed12-f98d-4c89-bf98-dea5fc2acbc3/main.py): Trading Logic (runs in background).
    -   [requirements.txt](file:///C:/Users/Ashbin/.gemini/antigravity/brain/2df2ed12-f98d-4c89-bf98-dea5fc2acbc3/requirements.txt): Python dependencies.
- `frontend/`: Frontend (Next.js)
    -   [app/page.tsx](file:///C:/Users/Ashbin/.gemini/antigravity/brain/2df2ed12-f98d-4c89-bf98-dea5fc2acbc3/frontend/app/page.tsx): Dashboard UI.
    -   [app/globals.css](file:///C:/Users/Ashbin/.gemini/antigravity/brain/2df2ed12-f98d-4c89-bf98-dea5fc2acbc3/frontend/app/globals.css): Styling.

## How to Run Locally

### 1. Setup Backend
```bash
# Install dependencies
pip install -r requirements.txt

# Run the API Server
python api.py
```
*The Backend will start on `http://localhost:8000` and automatically begin the trading bot loop.*

### 2. Setup Frontend
```bash
cd frontend

# Install dependencies
npm install

# Run the Development Server
npm run dev
```
*The Frontend will start on `http://localhost:3000`.*

---

## Deployment Guide

### Backend (Render)
1.  Push this repository to GitHub.
2.  Create a "Web Service" on **Render**.
3.  **Build Command**: `pip install -r requirements.txt`
4.  **Start Command**: `python api.py`
5.  **Environment Variables**: None required (unless you want to move credentials to env vars).

### Frontend (Vercel)
1.  Import the same repository on **Vercel**.
2.  **Root Directory**: Select `frontend`.
3.  **Environment Variables**:
    -   `NEXT_PUBLIC_API_URL`: **[The URL of your deployed Render Backend]** (e.g., `https://my-bot.onrender.com`)
4.  Deploy.

## Switching to Live Trading
Currently, `DRY_RUN = True` in [main.py](file:///C:/Users/Ashbin/.gemini/antigravity/brain/2df2ed12-f98d-4c89-bf98-dea5fc2acbc3/main.py). To enable real money execution:
1.  Edit [main.py](file:///C:/Users/Ashbin/.gemini/antigravity/brain/2df2ed12-f98d-4c89-bf98-dea5fc2acbc3/main.py).
2.  Set `DRY_RUN = False`.

## Version 2.0 Interface (New)

### Dashboard V2
The new dashboard features real-time stats cards, a sector heatmap, and quick actions.
![Dashboard V2](/C:/Users/Ashbin/.gemini/antigravity/brain/2df2ed12-f98d-4c89-bf98-dea5fc2acbc3/dashboard_v2_main_1768641360038.png)

### Active Trades Manager
Manage open positions with visual progress bars and a manual "Exit Now" override. Includes a Global Kill Switch.
![Active Trades](/C:/Users/Ashbin/.gemini/antigravity/brain/2df2ed12-f98d-4c89-bf98-dea5fc2acbc3/trades_v2_active_1768641384646.png)

### Settings & Configuration
Adjust Risk Parameters (SL/TP) and Trade Limits on the fly without restarting the bot.
![Settings Page](/C:/Users/Ashbin/.gemini/antigravity/brain/2df2ed12-f98d-4c89-bf98-dea5fc2acbc3/settings_v2_view_1768641372596.png)

---

## System Architecture

The system operates as a **Hybrid Infinite Loop & Event-Driven** architecture.

```mermaid
graph TD
    subgraph "External World"
        IS[IntradayScreener.com]
        Angel[Angel One SmartAPI]
    end

    subgraph "Backend (Python/FastAPI)"
        API[api.py (FastAPI)]
        Bot[main.py (Bot Loop)]
        State[(BOT_STATE)]
        WS_Hub[ws_hub.py (WebSocket Manager)]
        S_WS[smart_websocket.py (Order Updates)]
    end

    subgraph "Frontend (Next.js)"
        UI[Dashboard / Trades UI]
    end

    %% Data Flow
    IS -- Scrape Sectors --> Bot
    Angel -- Market Data --> Bot
    Bot -- Logic/Signals --> State
    State -- Broadcast --> WS_Hub
    WS_Hub -- Real-Time Updates --> UI

    %% User Interaction
    UI -- API Calls (Settings/Orders) --> API
    API -- Update Config --> State
    API -- Broadcast Change --> WS_Hub

    %% Order Flow
    Bot -- Place Order --> Angel
    Angel -- Order Status --> S_WS
    S_WS -- Update State --> State
    S_WS -- Trigger Broadcast --> WS_Hub
```

### Key Components

1.  **Bot Loop ([main.py](file:///C:/Users/Ashbin/.gemini/antigravity/brain/2df2ed12-f98d-4c89-bf98-dea5fc2acbc3/main.py))**: The brain. Runs every minute.
    *   **Step 1**: Scrapes top performing sectors.
    *   **Step 2**: Scans stocks in those sectors using Angel One API.
    *   **Step 3**: Generates Buy/Sell signals based on [indicators.py](file:///C:/Users/Ashbin/.gemini/antigravity/brain/2df2ed12-f98d-4c89-bf98-dea5fc2acbc3/indicators.py) (VWAP, EMA).
    *   **Step 4**: Manages active positions (Trailing SL, Targets).

2.  **API Server ([api.py](file:///C:/Users/Ashbin/.gemini/antigravity/brain/2df2ed12-f98d-4c89-bf98-dea5fc2acbc3/api.py))**: The bridge.
    *   Serves REST endpoints for the Frontend.
    *   Manages the WebSocket Hub.
    *   Accepts Settings updates and Kill Switch commands.

3.  **Shared State (`BOT_STATE`)**: The truth.
    *   A global in-memory dictionary shared between the API and Bot threads.
    *   Stores everything: Signals, Positions, Limits, logs.
    *   This is why the Dashboard is always in sync with the Bot.

4.  **WebSocket Hub**: The nervous system.
    *   Pushes `BOT_STATE` to the frontend instantly whenever something changes.
    *   No more refreshing the page!

---

## Ready for Action?
The system is fully configured and optimized.
- **Start Backend**: `python api.py`
- **Start Frontend**: `npm run dev`
- **Open Dashboard**: `http://localhost:3000`

ðŸš€


